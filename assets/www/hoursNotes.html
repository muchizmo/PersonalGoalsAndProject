<!DOCTYPE HTML>
<html>
<head>
<title>PhoneGap</title>
<script type="text/javascript" charset="utf-8" src="cordova-1.8.1.js"></script>
<script type="text/javascript" charset="utf-8" src="jquery-1.7.2.min.js"></script>
<style type="text/css">
#startBtn,#pauseBtn {
	color: blue;
}

.hoursCounter {
	background-color: LightGreen;
	width: 400px;
	min-height: 40px;
	min-height: 100%;
}

.separator {
	background-color: LightBlue;
	width: 400px;
	height: 4px;
}

.startTime {
	color: gray;
}
</style>
<title>Reporter</title>
<style type='text/css'>
body {
	font-family: sans-serif;
}
</style>
</head>
<body>
	<script>
	    /**
		hoursNotes=[];
		
		$(document).ready(
			function(){
				$.ajax( { url: "https://api.mongolab.com/api/1/databases/my_projects/collections/projects?s={'updated': -1}&apiKey=507d8f9be4b0335961b8c0f5",
			          type: "GET",
			          contentType: "application/json",
			          cache:false,
			          success: function(data){
			        	  for(i in data){
			        		  projectsList.push(data[i]);  
			        	  }
			        	  loadProjects();
			          }
				} );
			}		
		)
		
		function loadHoursNotes(){
			for(project in projectsList){
				addProject(projectsList[project]);
			}
		}
		
		function findProjectById(id){
			for(project in projectsList){
				if(projectsList[project]._id["$oid"]==id){
					return projectsList[project];
				}
			}
		}
		
		function updateProject(project){
			project.updated=new Date().getTime();
			$.ajax( { url: "https://api.mongolab.com/api/1/databases/my_projects/collections/projects?apiKey=507d8f9be4b0335961b8c0f5",
		          	data:JSON.stringify(project),
		          	cache:false,
					type: "POST",
		          	contentType: "application/json"
			});	
		}
		
		
		//TODO API dependent
		function projectTotalHours(project){
			totalHours=0;
			for(entry in project.hours){
				totalHours+=project.hours[entry].spent;
			}
			return totalHours;
		}
		
		//TODO API related fields.
		function addHourToProject(project){
			var spentHoursEntry={};
			spentHoursEntry.spent=1;
			spentHoursEntry.when=new Date().getTime();
			project.hours.push(spentHoursEntry);
			updateProject(project);
			$('#'+project._id["$oid"]+' .totalHours').html(projectTotalHours(project));
		}
		
		//create empty project after user click
		function addNewProject(){
			var newProject={};
			newProject.created=new Date().getTime();
			newProject.updated=newProject.created;
			newProject.name="";
			newProject.hours=[];
			$.ajax( { url: "https://api.mongolab.com/api/1/databases/my_projects/collections/projects?apiKey=507d8f9be4b0335961b8c0f5",
		          data:JSON.stringify(newProject),
					type: "POST",
		          contentType: "application/json",
		          cache:false,
		          success: function(data){
		        	  newProject._id={}
		        	  newProject._id["$oid"]=data._id["$oid"];
		        	  projectsList.push(newProject);
		        	  addProject(newProject);
		          }
			});
		}
	
		//used to populate gui
		function addProject(project) {
			
			$('.hoursCounterTemplate')
								.clone()
								.removeClass('hoursCounterTemplate')
								.addClass('hoursCounter')
								.attr("id",project._id["$oid"])
								.appendTo('#interactBlock');
			if(project.name==""){
				$('#'+project._id["$oid"]+' .descriptionSubmit').html(project.name)
				.css('display', 'inline');	
			}else{
				$('#'+project._id["$oid"]+' .description').html(project.name)
				.css('display', 'inline');
			}
			if(project.hours.length>0){
				$('#'+project._id["$oid"]+' .totalHours').html(projectTotalHours(project));
			}
			$('#'+project._id["$oid"]).click(
				function(event){
					if(event.target.className=="hoursCounter"){
						addHourToProject(project);
					}
				}		
			)

            $('#'+project._id["$oid"]+' .totalHours').click( function(){
                project._id["$oid"]
            });
			
			
		}
		
		function descriptionEdit(event) {
			$(event.target).css('display', 'none')
			$(event.target).parent().find('.descriptionSubmit').css('display',
					'inline')
		}
		function textAreaSubmit(event) {
			//TODO update
			if (13 == event.keyCode) {
				var projectId=$(event.target).parent().attr('id');
				var project=findProjectById(projectId);
				project.name=$(event.target).val();
				//ajax update 
				updateProject(project);
				$(event.target).css('display', 'none')
				$(event.target).parent().find('.description').html(project.name).css('display', 'inline');
			}
		}
		function onTextAreaBlur(event) {
			//TODO update
			$(event.target).css('display', 'none')
			$(event.target).parent().find('.description').html(
					$(event.target).val()).css('display', 'inline')
		} */
	</script>
	<div id="interactBlock">
		<div id="btns">
			<a id='addProjectBtn' onclick='return addNewProject()'>Add Note</a>
		</div>
		<div class='hoursCounterTemplate'>
			<div class='toolBar'>
				<a class="totalHours"></a>
                <a class="hoursNotes">Notes</a>
			</div>
			<a class="description" onclick='return descriptionEdit(event)'></a>
			<textarea class='descriptionSubmit' rows="1" cols="20"
				style='display: none' onblur='onTextAreaBlur(event)'
				onkeypress='return textAreaSubmit(event)'></textarea>
			<br>
			<div class='separator' />
		</div>
	</div>
</body>
</html>